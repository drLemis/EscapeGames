<!DOCTYPE html>
<html>
<body>
<p>Amount of members:<input id="membersAmount" type="number" min="1" max="50">
<button onclick="test()">Test!</button>
<p id="result"></p>



<script>
var member = [,,,];
var hour = 0;

function test(){
	document.getElementById("result").innerHTML = "";
	
	if (document.getElementById('membersAmount').value <= document.getElementById('membersAmount').min){
		document.getElementById('membersAmount').value = document.getElementById('membersAmount').min;
	}
	
	if (document.getElementById('membersAmount').value >= document.getElementById('membersAmount').max||document.getElementById('membersAmount').value >=100){
		document.getElementById('membersAmount').value = document.getElementById('membersAmount').max;
	}
	
	
	for (var i = 0; i <= document.getElementById('membersAmount').value-1 ; i++){
		member[i] = createMember();
	}
	
	hour = 0;
	makeAction();
}



function makeAction() {
	var aliveMembers = 0;
	for (var i = 0; i <= document.getElementById('membersAmount').value-1; i++) {
		if (member[i][0]==0){
			displayAction(member[i]);
			if (member[i][0]==0){
				aliveMembers++;
			}
		}
	}
	
	
	if (aliveMembers>0){
		newHour();
	}
}

function displayAction(activeMember){
	document.getElementById("result").innerHTML = document.getElementById("result").innerHTML + "<p>" + activeMember[2]+" "+activeMember[3]+", "+activeMember[1]+", "+activeMember[4]+" with "+activeMember[5]+" in hands, "+getRandomAction(activeMember);
}

function newHour(){
	hour++;
	document.getElementById("result").innerHTML = document.getElementById("result").innerHTML + "<p>" + "HOURS FROM COLLAPSE: "+ hour;
	makeAction()
}

function createMember(){
	var gender = ["male", "female"];
	var role = ["guard", "scientist", "technitian", "D-class", "visitor"];
	
	var activeMember = [,,,,,]
	
	activeMember[0] = 0;
	activeMember[1] = gender[Math.floor(Math.random()*(gender.length))];
	activeMember[2] = getRandomFirstName(activeMember[1])
	activeMember[3] = getRandomSecondName();
	activeMember[4] = role[Math.floor(Math.random()*(role.length))];
	activeMember[5] = getRandomWeapon();
		
	return activeMember;
	
}

function getRandomFirstName(gender){
	var namePool = "";
		

	if (gender=="male"){
		namePool = httpGet("https://raw.githubusercontent.com/drLemis/EscapeGames/master/MaleFirstName").split("\n");
	
	}
	if (gender=="female"){
		namePool = httpGet("https://raw.githubusercontent.com/drLemis/EscapeGames/master/FemaleFirstName").split("\n");
	}
	
	return namePool[Math.floor(Math.random()*(namePool.length))];
}

function getRandomSecondName(){

	var namePool = httpGet("https://raw.githubusercontent.com/drLemis/EscapeGames/master/SecondName").split("\n");
	return namePool[Math.floor(Math.random()*(namePool.length))];
}

function getRandomWeapon(currentWeapon){
	var weapon = ["nothing","pencil","baton","gun"]
	var foundWeapon = weapon[Math.floor(Math.random()*(weapon.length))];
	if (weapon.indexOf(currentWeapon)>=weapon.indexOf(foundWeapon)){
		return currentWeapon;
	}
	return foundWeapon;
}

function getRandomAction(activeMember){
	var actions = ["dies in fight", "found ", "escaping with a vent shaft", "searching for supplies", "reaching the evacuation zone", "crying alone", "stalking another survivor", "commiting suicide"];
	var activeAction = actions[Math.floor(Math.random() * (actions.length))];
	if (activeAction=="dies in fight"||activeAction=="commiting suicide"){
		activeAction="<font color='red'>"+activeAction+"</font>"
		activeMember[0]=1;
	}
	if (activeAction=="reaching the evacuation zone"){
		activeAction="<font color='green'>"+activeAction+"</font>"
		activeMember[0]=2;
	}
	if (activeAction=="found "){
		var tempWeapon = getRandomWeapon(activeMember[5]);
		if (tempWeapon==activeMember[5]){
			activeAction = getRandomAction(activeMember);
			return activeAction;
		}
		activeMember[5]=tempWeapon;
		activeAction = activeAction+activeMember[5];
	}
	
	return activeAction;
}


function httpGet(theUrl)
  {
    var xmlHttp = null;

    xmlHttp = new XMLHttpRequest();
    xmlHttp.open( "GET", theUrl, false );
    xmlHttp.send( null );
    return xmlHttp.responseText;
  }

</script>
</body>
</html>
